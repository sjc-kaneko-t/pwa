<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta http-equiv="Pragma" content="no-cache">
  <link rel="manifest" href="manifest.json">
  <!-- <title>Tetris_app</title> -->
  <!--leaflet-->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>

  <!--demo stuff-->
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
</head>

<body>
  <div>index</div>
  <div><a href="hoge/index.html">hoge/index</a></div>
  version047
  <!-- <div><a href="hoge/no_cache.html">hoge/no_cache</a></div> -->
  <div id="map" style="height: 300px;width: 300px;"></div>

  <!-- カメラ -->
  <!-- <button>take a snapshot</button>
    <video id="camera"></video> -->

  <script>
    $(document).ready(function () {
      // MAP
      const map = L.map("map").setView([250, 152], 5);
      L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
      ).addTo(map);

      function currentPos() {
        alert('start');

        //APIに対応していないブラウザを排除
        if (navigator.geolocation === false) {
          alert("位置情報を取得できません。ブラウザが対応していません。");
        }

        //位置情報取得オプションを設定(後述)
        var options = {
          enableHighAccuracy: false,
          timeout: 5000,
          maximumAge: 0
        };

        //取得成功時の動作設定
        function success(pos) {
          alert('success');
          var lat = pos.coords.latitude; //緯度
          var lon = pos.coords.longitude; //経度
          map.setView([lat, lon]); //地図を移動
        }

        //取得失敗時(タイムアウトなど)の動作設定
        function error(err) {
          alert("位置情報を取得できませんでした。デバイスに位置情報を取得できる装置が無い、または取得に時間がかかっている、またはデバイスやブラウザ設定でブロックされています");
        }

        //コマンドを実行
        navigator.geolocation.getCurrentPosition(success, error, options);
      }

      navigator.geolocation.watchPosition(function () {
        currentPos();
      });

      currentPos();

      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').then(function (registration) {
          // if (typeof registration.update == 'function') {
          //   registration.update();
          // }
          // registration.onupdatefound = function() {
          //   console.log("アップデーと");
          //   registration.update();
          // }
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
          let page = localStorage.getItem('page')
          if (page) {
            localStorage.removeItem('page')
            location.href = page
          }

        }).catch(function (err) {
          console.log('ServiceWorker registration failed: ', err);
        });
      }
    });
  </script>
</body>

</html>